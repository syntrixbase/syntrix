server:
  host: "localhost"
  http_port: 8080
  http_read_timeout: 10s
  http_write_timeout: 10s
  http_idle_timeout: 60s
  enable_cors: true

  grpc_port: 9000
  GRPCMaxConcurrent: 100

  ShutdownTimeout: 15s

storage:
  backends:
    default_mongo:
      type: mongo
      mongo:
        uri: "mongodb://localhost:27017"
        database_name: "syntrix"
  topology:
    document:
      strategy: single
      primary: default_mongo
      data_collection: documents
      sys_collection: sys
      soft_delete_retention: 720h # 30 days
    user:
      strategy: single
      primary: default_mongo
      collection: users
    revocation:
      strategy: single
      primary: default_mongo
      collection: revocations

identity:
  authn:
    access_token_ttl: 15m
    refresh_token_ttl: 168h # 7 days
    auth_code_ttl: 2m
    private_key_file: "keys/auth_private.pem"
  authz:
    rules_file: "security.yaml"

gateway:
  query_service_url: "localhost:9000"
  streamer_service_url: "localhost:9000"
  realtime:
    transport: "both"
    per_message_deflate: true

query:
  indexer_addr: "localhost:9000"

trigger:
  nats_url: "nats://localhost:4222"
  rules_file: "triggers.example.json"
  worker_count: 32
  stream_name: "TRIGGERS"

puller:
  grpc:
    address: ":50051"
    max_connections: 100
    channel_size: 10000
  backends:
    - name: "default_mongo"
      collections: ["documents"]
  buffer:
    path: ".syntrix/data/puller/events"
    max_size: "10GiB"
    batch_size: 100
    batch_interval: 100ms
    queue_size: 10000
  consumer:
    catch_up_threshold: 100000
    coalesce_on_catch_up: true
  cleaner:
    interval: 1m
    retention: 1h
  bootstrap:
    mode: "from_now"
  metrics:
    port: 9090
    path: "/metrics"
  health:
    port: 8081
    path: "/health"

streamer:
  server:
    puller_addr: "localhost:9000"
    send_timeout: 5s
  client:
    streamer_addr: "localhost:9000"
    initial_backoff: 1s
    max_backoff: 30s
    backoff_multiplier: 2.0
    max_retries: 0
    heartbeat_interval: 30s
    activity_timeout: 90s

indexer:
  puller_addr: "localhost:9000"
  template_path: "index_templates.yaml"
  progress_path: "data/indexer/progress"
  consumer_id: "indexer"
  reconcile_interval: 5s
  storage_mode: "memory"
  store:
    path: "data/indexer/indexes.db"
    batch_size: 100
    batch_interval: 100ms
    queue_size: 10000
    block_cache_size: 134217728
