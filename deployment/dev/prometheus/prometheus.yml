# Prometheus Configuration for Syntrix Development
# =================================================
# Optimized for low CPU usage when idle

global:
  scrape_interval: 60s      # Increased to 60s - minimal CPU impact
  evaluation_interval: 60s  # Increased to 60s
  # Prometheus 3.x requires fallback protocol when Content-Type is missing
  scrape_protocols: ["OpenMetricsText1.0.0", "OpenMetricsText0.0.1", "PrometheusText1.0.0", "PrometheusText0.0.4"]
  external_labels:
    environment: "dev"
    cluster: "local"

# Alerting configuration - disabled for dev to reduce CPU
alerting:
  alertmanagers: []

# Rule files - commented out to disable rule evaluation
# rule_files:
#   - "alerts.yml"

# Scrape configurations
scrape_configs:
  # =============================================================================
  # Prometheus Self-Monitoring (optional - can be disabled to save CPU)
  # =============================================================================
  # - job_name: "prometheus"
  #   static_configs:
  #     - targets: ["localhost:9090"]
  #       labels:
  #         service: "prometheus"

  # =============================================================================
  # Syntrix Application
  # =============================================================================
  - job_name: "syntrix"
    scrape_interval: 60s  # Override global for this job
    # When running Syntrix outside Docker (local development)
    static_configs:
      - targets: ["host.docker.internal:8080"]
        labels:
          service: "syntrix"
          mode: "standalone"

    # Metric relabeling to filter out unnecessary metrics
    metric_relabel_configs:
      # Keep only Syntrix-specific metrics and essential Go metrics
      - source_labels: [__name__]
        regex: "(syntrix_|puller_|trigger_|gateway_|query_|indexer_|streamer_|go_goroutines|go_memstats_alloc_bytes|process_cpu_seconds_total).*"
        action: keep

  # =============================================================================
  # Infrastructure Monitoring (optional - can be disabled to save CPU)
  # =============================================================================
  # - job_name: "nats"
  #   scrape_interval: 60s
  #   static_configs:
  #     - targets: ["nats:8222"]
  #       labels:
  #         service: "nats"
  #   metrics_path: "/varz"

  # =============================================================================
  # MongoDB (requires mongodb_exporter, optional)
  # =============================================================================
  # - job_name: "mongodb"
  #   static_configs:
  #     - targets: ["mongodb-exporter:9216"]
  #       labels:
  #         service: "mongodb"
