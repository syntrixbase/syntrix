# Task 030: Console Modernization

**Created:** 2026-01-07  
**Status:** Planning  
**Design Doc:** [docs/design/server/010_console.md](../docs/design/server/010_console.md)  
**Development Mode:** AI-Assisted (tasks designed for AI agent execution)

## Objective

Modernize the Syntrix Console from a single-file HTML to a production-ready React + TypeScript application with full CRUD, user management, rules editor, and monitoring features.

---

## Task Breakdown

Each task is atomic and can be executed by AI in a single session. Tasks include clear inputs, outputs, and verification steps.

### Phase 1: Project Foundation

#### Task 1.1: Initialize Project Structure
**Input:** Empty `console/` directory (backup existing `index.html` to `legacy.html`)  
**Output:** Vite + React + TypeScript project scaffold  
**Steps:**
1. Rename `console/index.html` → `console/legacy.html`
2. Run `cd console && bun create vite . --template react-ts`
3. Create `tailwind.config.js`, `postcss.config.js`
4. Update `package.json` with dependencies: `tailwindcss`, `postcss`, `autoprefixer`, `zustand`, `react-router-dom`, `lucide-react`
5. Create `src/index.css` with Tailwind directives
6. Verify: `bun install && bun run dev` starts without errors

#### Task 1.2: Create Base UI Components
**Input:** Initialized project from 1.1  
**Output:** `src/components/ui/` with reusable components  
**Files to create:**
```
src/components/ui/
├── Button.tsx      # variants: primary, secondary, danger, ghost
├── Input.tsx       # text, password, with label and error state
├── Table.tsx       # headers, rows, loading skeleton
├── Modal.tsx       # overlay, close button, slots for content
├── Toast.tsx       # success/error/warning/info variants
├── Loading.tsx     # spinner and skeleton variants
└── index.ts        # re-exports
```
**Verify:** Import each component in `App.tsx`, render, no TypeScript errors

#### Task 1.3: Create Layout Components
**Input:** UI components from 1.2  
**Output:** `src/components/layout/` with app shell  
**Files to create:**
```
src/components/layout/
├── Sidebar.tsx     # nav items, collapsible, role-based visibility
├── Header.tsx      # title, user info, logout button
└── Layout.tsx      # combines Sidebar + Header + main content area
```
**Verify:** Wrap `App.tsx` with `Layout`, sidebar renders with nav items

#### Task 1.4: Setup Routing
**Input:** Layout from 1.3  
**Output:** React Router configuration with pages  
**Files to create:**
```
src/pages/
├── Login.tsx       # standalone, no layout
├── Dashboard.tsx   # welcome message, quick stats placeholder
├── DataBrowser.tsx # placeholder
├── Users.tsx       # placeholder
├── Rules.tsx       # placeholder
└── Monitoring.tsx  # placeholder

src/App.tsx         # Router setup with protected routes
```
**Verify:** Navigate between pages, URL updates correctly

#### Task 1.5: Implement Auth Store & API Client
**Input:** Project structure from previous tasks  
**Output:** Authentication state management and HTTP client  
**Files to create:**
```
src/stores/
└── authStore.ts    # Zustand store: token, user, login, logout, refresh

src/api/
├── client.ts       # fetch wrapper with auth header, 401 handling
├── auth.ts         # login, logout, refresh, signup endpoints
└── types.ts        # User, TokenPair, ApiError types
```
**Verify:** 
1. Call `login('syntrix', 'adminpassword123')` 
2. Token stored in state
3. Subsequent requests include Authorization header

#### Task 1.6: Implement Login Page
**Input:** Auth store and API client from 1.5  
**Output:** Functional login page  
**Implement in:** `src/pages/Login.tsx`
**Features:**
- Form with username/password inputs
- Submit calls `authStore.login()`
- Error display on failure
- Redirect to Dashboard on success
- Loading state during request

**Verify:** Login with `syntrix` / `adminpassword123`, lands on Dashboard

---

### Phase 2: Core Features

#### Task 2.1: Document API Client
**Input:** Base API client from 1.5  
**Output:** `src/api/documents.ts`  
**Endpoints to implement:**
```typescript
query(collection: string, filters?: Filter[]): Promise<Document[]>
get(path: string): Promise<Document>
create(path: string, data: object): Promise<Document>
update(path: string, data: object): Promise<Document>
delete(path: string): Promise<void>
```
**Verify:** `query('messages')` returns array of documents

#### Task 2.2: Data Browser - Collection List
**Input:** Document API from 2.1  
**Output:** Collection tree in DataBrowser page  
**Implement in:** `src/pages/DataBrowser.tsx`, `src/components/features/data-browser/CollectionTree.tsx`
**Features:**
- Fetch unique collections from query results
- Display as list/tree in sidebar
- Click to select collection
- Selected state highlighted

**Verify:** See "messages" collection, click selects it

#### Task 2.3: Data Browser - Document List
**Input:** Collection selection from 2.2  
**Output:** Document list view  
**Implement in:** `src/components/features/data-browser/DocumentList.tsx`
**Features:**
- Fetch documents for selected collection
- Display in Table component
- Show id, createdAt, preview of data
- Pagination (limit/offset)
- Loading skeleton

**Verify:** Select "messages", see list of 31 documents with pagination

#### Task 2.4: Data Browser - Document Viewer
**Input:** Document list from 2.3  
**Output:** JSON viewer panel  
**Implement in:** `src/components/features/data-browser/DocumentViewer.tsx`
**Features:**
- Click document row to view
- JSON pretty-print with syntax highlighting
- Copy to clipboard button
- Close button

**Verify:** Click document, see formatted JSON in side panel

#### Task 2.5: Data Browser - Document Editor
**Input:** Document viewer from 2.4  
**Output:** Edit and delete functionality  
**Implement in:** `src/components/features/data-browser/DocumentEditor.tsx`
**Features:**
- Edit button opens JSON textarea
- Save calls PATCH API
- Delete button with confirm modal
- Success/error toast

**Verify:** Edit a document's text field, save, refresh shows new value

#### Task 2.6: Data Browser - Create Document
**Input:** Document list from 2.3  
**Output:** Create new document form  
**Features:**
- "New Document" button
- Modal with JSON textarea
- Path input (collection/id)
- Create calls POST API
- Success toast, list refreshes

**Verify:** Create new document in messages, appears in list

#### Task 2.7: Admin API Client
**Input:** Base API client  
**Output:** `src/api/admin.ts`  
**Endpoints:**
```typescript
listUsers(limit?: number, offset?: number): Promise<User[]>
updateUser(id: string, roles: string[], disabled: boolean): Promise<void>
getRules(): Promise<RuleSet>
pushRules(content: string): Promise<void>
```
**Verify:** `listUsers()` returns array of users

#### Task 2.8: User Management Page
**Input:** Admin API from 2.7  
**Output:** Functional Users page  
**Implement in:** `src/pages/Users.tsx`, `src/components/features/users/`
**Features:**
- User list table (id, username, roles, status)
- Enable/disable toggle
- Role editor (checkbox for admin)
- Search by username
- Filter by status

**Verify:** See user list, disable a user, refresh shows disabled

#### Task 2.9: Rules Viewer
**Input:** Admin API from 2.7  
**Output:** Rules display in Rules page  
**Implement in:** `src/pages/Rules.tsx`, `src/components/features/rules/RulesViewer.tsx`
**Features:**
- Fetch current rules on load
- Display with syntax highlighting (YAML)
- Copy button

**Verify:** See current security.yaml rules content

#### Task 2.10: Rules Editor
**Input:** Rules viewer from 2.9  
**Output:** Edit and push rules  
**Implement in:** `src/components/features/rules/RulesEditor.tsx`
**Features:**
- Edit button switches to textarea
- Push button with confirm modal
- Success/error feedback
- Cancel reverts changes

**Verify:** Modify rules, push, fetch shows new content

---

### Phase 3: Monitoring & Polish

#### Task 3.1: Dashboard Stats
**Input:** APIs from Phase 2  
**Output:** Dashboard with quick stats  
**Features:**
- Total documents count
- Total users count
- System health status (from /health)
- Recent activity placeholder

**Verify:** Dashboard shows stats fetched from APIs

#### Task 3.2: Health Monitor
**Input:** Health endpoint  
**Output:** Monitoring page  
**Implement in:** `src/pages/Monitoring.tsx`
**Features:**
- Health status card (green/red)
- Auto-refresh every 30s
- Error display if unhealthy

**Verify:** Health card shows "Healthy" status

#### Task 3.3: Token Auto-Refresh
**Input:** Auth store from 1.5  
**Output:** Automatic token refresh before expiry  
**Implement in:** `src/stores/authStore.ts`
**Features:**
- Parse JWT to get expiry
- Schedule refresh 1 minute before
- Show warning toast 5 min before session end

**Verify:** Stay logged in, token refreshes automatically (check network)

#### Task 3.4: Dark Mode
**Input:** TailwindCSS setup  
**Output:** Theme toggle  
**Features:**
- Add `dark` class support in Tailwind
- Theme toggle in Header
- Persist preference in localStorage
- All components respect dark mode

**Verify:** Toggle dark mode, all pages render correctly

#### Task 3.5: Responsive Layout
**Input:** Layout components  
**Output:** Mobile-friendly layout  
**Features:**
- Collapsible sidebar on mobile
- Hamburger menu
- Table horizontal scroll
- Modal full-width on mobile

**Verify:** Resize to mobile width, UI remains usable

#### Task 3.6: Server Integration
**Input:** Built console  
**Output:** Server serves new console  
**Steps:**
1. Run `bun run build` in console/
2. Update `internal/api/server.go` to serve `console/dist/`
3. Test `/console/` route serves new app

**Verify:** `http://localhost:8080/console/` loads new React app

---

## Execution Notes for AI

1. **One task per session**: Complete one task fully before moving to next
2. **Verify before proceeding**: Run verification step, fix issues
3. **Ask if blocked**: If unclear requirements, ask user for clarification
4. **Test as you go**: Run `bun run dev` frequently to catch errors
5. **Commit checkpoints**: Suggest commit after each major task group

## Dependencies

```json
{
  "dependencies": {
    "react": "^18.x",
    "react-dom": "^18.x",
    "react-router-dom": "^6.x",
    "zustand": "^4.x",
    "lucide-react": "^0.x"
  },
  "devDependencies": {
    "typescript": "^5.x",
    "vite": "^5.x",
    "tailwindcss": "^3.x",
    "postcss": "^8.x",
    "autoprefixer": "^10.x",
    "@types/react": "^18.x",
    "@types/react-dom": "^18.x"
  }
}
```

## API Reference

| Endpoint | Method | Body | Response |
|----------|--------|------|----------|
| `/auth/v1/login` | POST | `{tenant, username, password}` | `{access_token, refresh_token, expires_in}` |
| `/auth/v1/refresh` | POST | `{refresh_token}` | `{access_token, refresh_token, expires_in}` |
| `/api/v1/query` | POST | `{tenant, collection, filters?}` | `Document[]` |
| `/api/v1/{path}` | GET | - | `Document` |
| `/api/v1/{path}` | POST | `{...data}` | `Document` |
| `/api/v1/{path}` | PATCH | `{...data}` | `Document` |
| `/api/v1/{path}` | DELETE | - | `204` |
| `/admin/users` | GET | - | `User[]` |
| `/admin/users/{id}` | PATCH | `{roles, disabled}` | `200` |
| `/admin/rules` | GET | - | `RuleSet` |
| `/admin/rules/push` | POST | `yaml content` | `200` |
| `/health` | GET | - | `200 OK` |
