# SDK WS/SSE Auth + Multi-Tenant Review

Date: December 27, 2025
Status: Completed
Scope: Capture gaps in the TypeScript SDK after introducing WS/SSE authentication and multi-tenant enforcement; feed fixes into SDK and docs.

## Findings (Why / How)

- Login omits tenant (Why: server login now requires tenant to issue scoped tokens; How: `DefaultTokenProvider.login` posts `{username,password}` without `tenantId`, so login fails or issues default-scope tokens.)
- Realtime SSE missing client path (Why: new `/realtime/sse` endpoint needs SDK affordance; How: `SyntrixClient.realtime()` only builds WS URL `/realtime/ws`, so apps cannot use SSE with auth via SDK.)
- WS auth refresh/resilience gap (Why: WS auth can fail on expired or tenant-mismatched tokens; How: `RealtimeClient` marks state `connected` before auth ack, reuses stale token on reconnect, and does not attempt refresh or downgrade state on auth errors, leading to repeated rejects.)
- Documentation stale (Why: SDK docs still describe single-tenant init and no SSE/tenant guidance; How: `docs/reference/typescript_sdk.md` shows `new SyntrixClient('<URL>', 'YOUR_ACCESS_TOKEN')` and lacks tenant/SSE setup.)

## Recommended Remediations

- Require tenant in SDK auth flows: extend `AuthConfig` and `login(username, password, tenantId)` to send `tenantId`; propagate into refresh/login URLs; add tests for tenanted login/logout/refresh.
- Add SSE client support: expose `realtimeSSE()` or options to select SSE transport; ensure auth via headers, no query tokens; document usage.
- Harden WS auth lifecycle: track auth state, react to `error`/auth failures by refreshing token once and retrying, otherwise surface `onError` and set state `error` to stop jitter loops; resubscribe only after auth success; add tests for 401/403 and token refresh on reconnect.
- Update SDK docs: include tenant-aware initialization examples, WS vs SSE selection, and auth requirements; note multi-tenant isolation expectations.

## Risks / Notes

- Refresh retry must avoid infinite loops; cap attempts and bubble errors.
- SSE support should reuse existing auth headers and origin rules; avoid query-string tokens to match server policy.

## Status Log

- 2025-12-27: Recorded review findings; status set to In Progress.
